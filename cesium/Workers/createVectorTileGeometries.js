define(["./Transforms-e2d4a55a","./BoxGeometry-af7d05ef","./Matrix3-41c58dde","./Color-8e135f71","./CylinderGeometry-dbaa1678","./defaultValue-fe22d8c0","./EllipsoidGeometry-8155e3a2","./IndexDatatype-2643aa47","./Matrix2-e1298525","./createTaskProcessorWorker","./Check-6ede7e26","./Math-0a2ac845","./combine-d9581036","./RuntimeError-ef395448","./ComponentDatatype-cf1fa08e","./WebGLConstants-0b1ce7ba","./GeometryAttribute-13da9466","./GeometryAttributes-ad136444","./GeometryOffsetAttribute-9ad0019c","./VertexFormat-030f11ff","./CylinderGeometryLibrary-7bf291b4"],(function(e,t,n,a,r,i,o,s,d,c,l,f,u,h,p,b,y,x,g,m,C){"use strict";function I(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds}const k=new n.Cartesian3,M=d.Matrix4.packedLength+n.Cartesian3.packedLength,B=d.Matrix4.packedLength+2,w=d.Matrix4.packedLength+n.Cartesian3.packedLength,A=n.Cartesian3.packedLength+1,O={modelMatrix:new d.Matrix4,boundingVolume:new e.BoundingSphere};function L(e,t){let a=t*M;const r=n.Cartesian3.unpack(e,a,k);a+=n.Cartesian3.packedLength;const i=d.Matrix4.unpack(e,a,O.modelMatrix);d.Matrix4.multiplyByScale(i,r,i);const o=O.boundingVolume;return n.Cartesian3.clone(n.Cartesian3.ZERO,o.center),o.radius=Math.sqrt(3),O}function v(e,t){let a=t*B;const r=e[a++],i=e[a++],o=n.Cartesian3.fromElements(r,r,i,k),s=d.Matrix4.unpack(e,a,O.modelMatrix);d.Matrix4.multiplyByScale(s,o,s);const c=O.boundingVolume;return n.Cartesian3.clone(n.Cartesian3.ZERO,c.center),c.radius=Math.sqrt(2),O}function E(e,t){let a=t*w;const r=n.Cartesian3.unpack(e,a,k);a+=n.Cartesian3.packedLength;const i=d.Matrix4.unpack(e,a,O.modelMatrix);d.Matrix4.multiplyByScale(i,r,i);const o=O.boundingVolume;return n.Cartesian3.clone(n.Cartesian3.ZERO,o.center),o.radius=1,O}function U(e,t){let a=t*A;const r=e[a++],i=n.Cartesian3.unpack(e,a,k),o=d.Matrix4.fromTranslation(i,O.modelMatrix);d.Matrix4.multiplyByUniformScale(o,r,o);const s=O.boundingVolume;return n.Cartesian3.clone(n.Cartesian3.ZERO,s.center),s.radius=1,O}const G=new n.Cartesian3;function S(t,r,o,s,c){if(!i.defined(r))return;const l=o.length,f=s.attributes.position.values,u=s.indices,h=t.positions,p=t.vertexBatchIds,b=t.indices,y=t.batchIds,x=t.batchTableColors,g=t.batchedIndices,m=t.indexOffsets,C=t.indexCounts,k=t.boundingVolumes,M=t.modelMatrix,B=t.center;let w=t.positionOffset,A=t.batchIdIndex,O=t.indexOffset;const L=t.batchedIndicesOffset;for(let t=0;t<l;++t){const i=c(r,t),s=i.modelMatrix;d.Matrix4.multiply(M,s,s);const l=o[t],v=f.length;for(let e=0;e<v;e+=3){const t=n.Cartesian3.unpack(f,e,G);d.Matrix4.multiplyByPoint(s,t,t),n.Cartesian3.subtract(t,B,t),n.Cartesian3.pack(t,h,3*w+e),p[A++]=l}const E=u.length;for(let e=0;e<E;++e)b[O+e]=u[e]+w;const U=t+L;g[U]=new I({offset:O,count:E,color:a.Color.fromRgba(x[l]),batchIds:[l]}),y[U]=l,m[U]=O,C[U]=E,k[U]=e.BoundingSphere.transform(i.boundingVolume,s),w+=v/3,O+=E}t.positionOffset=w,t.batchIdIndex=A,t.indexOffset=O,t.batchedIndicesOffset+=l}const V=new n.Cartesian3,T=new d.Matrix4;return c((function(c,l){const f=i.defined(c.boxes)?new Float32Array(c.boxes):void 0,u=i.defined(c.boxBatchIds)?new Uint16Array(c.boxBatchIds):void 0,h=i.defined(c.cylinders)?new Float32Array(c.cylinders):void 0,p=i.defined(c.cylinderBatchIds)?new Uint16Array(c.cylinderBatchIds):void 0,b=i.defined(c.ellipsoids)?new Float32Array(c.ellipsoids):void 0,y=i.defined(c.ellipsoidBatchIds)?new Uint16Array(c.ellipsoidBatchIds):void 0,x=i.defined(c.spheres)?new Float32Array(c.spheres):void 0,g=i.defined(c.sphereBatchIds)?new Uint16Array(c.sphereBatchIds):void 0,m=i.defined(f)?u.length:0,C=i.defined(h)?p.length:0,I=i.defined(b)?y.length:0,k=i.defined(x)?g.length:0,M=t.BoxGeometry.getUnitBox(),B=r.CylinderGeometry.getUnitCylinder(),w=o.EllipsoidGeometry.getUnitEllipsoid(),A=M.attributes.position.values,O=B.attributes.position.values,G=w.attributes.position.values;let F=A.length*m;F+=O.length*C,F+=G.length*(I+k);const R=M.indices,Z=B.indices,D=w.indices;let P=R.length*m;P+=Z.length*C,P+=D.length*(I+k);const q=new Float32Array(F),W=new Uint16Array(F/3),_=s.IndexDatatype.createTypedArray(F/3,P),N=m+C+I+k,Y=new Uint16Array(N),j=new Array(N),z=new Uint32Array(N),H=new Uint32Array(N),J=new Array(N);!function(e){const t=new Float64Array(e);let a=0;n.Cartesian3.unpack(t,a,V),a+=n.Cartesian3.packedLength,d.Matrix4.unpack(t,a,T)}(c.packedBuffer);const K={batchTableColors:new Uint32Array(c.batchTableColors),positions:q,vertexBatchIds:W,indices:_,batchIds:Y,batchedIndices:j,indexOffsets:z,indexCounts:H,boundingVolumes:J,positionOffset:0,batchIdIndex:0,indexOffset:0,batchedIndicesOffset:0,modelMatrix:T,center:V};S(K,f,u,M,L),S(K,h,p,B,v),S(K,b,y,w,E),S(K,x,g,w,U);const Q=function(t,n,r){const i=r.length,o=2+i*e.BoundingSphere.packedLength+1+function(e){const t=e.length;let n=0;for(let r=0;r<t;++r)n+=a.Color.packedLength+3+e[r].batchIds.length;return n}(n),s=new Float64Array(o);let d=0;s[d++]=t,s[d++]=i;for(let t=0;t<i;++t)e.BoundingSphere.pack(r[t],s,d),d+=e.BoundingSphere.packedLength;const c=n.length;s[d++]=c;for(let e=0;e<c;++e){const t=n[e];a.Color.pack(t.color,s,d),d+=a.Color.packedLength,s[d++]=t.offset,s[d++]=t.count;const r=t.batchIds,i=r.length;s[d++]=i;for(let e=0;e<i;++e)s[d++]=r[e]}return s}(_.BYTES_PER_ELEMENT,j,J);return l.push(q.buffer,W.buffer,_.buffer),l.push(Y.buffer,z.buffer,H.buffer),l.push(Q.buffer),{positions:q.buffer,vertexBatchIds:W.buffer,indices:_.buffer,indexOffsets:z.buffer,indexCounts:H.buffer,batchIds:Y.buffer,packedBuffer:Q.buffer}}))}));