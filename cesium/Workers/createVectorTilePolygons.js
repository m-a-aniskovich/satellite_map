define(["./AttributeCompression-f9f6c717","./Matrix3-41c58dde","./Color-8e135f71","./defaultValue-fe22d8c0","./IndexDatatype-2643aa47","./Math-0a2ac845","./OrientedBoundingBox-29fb0fcd","./Matrix2-e1298525","./createTaskProcessorWorker","./ComponentDatatype-cf1fa08e","./Check-6ede7e26","./WebGLConstants-0b1ce7ba","./Transforms-e2d4a55a","./combine-d9581036","./RuntimeError-ef395448","./EllipsoidTangentPlane-546c0d5e","./AxisAlignedBoundingBox-4bfd84f3","./IntersectionTests-85350792","./Plane-4c3d403b"],(function(e,t,n,a,r,o,i,s,c,f,d,l,u,h,g,p,b,m,y){"use strict";const C=new t.Cartesian3,I=new t.Ellipsoid,x=new s.Rectangle,w={min:void 0,max:void 0,indexBytesPerElement:void 0};const A=new t.Cartesian3,E=new t.Cartesian3,N=new t.Cartesian3,T=new t.Cartesian3,k=new t.Cartesian3,B=new t.Cartographic,L=new s.Rectangle;return c((function(c,f){let d;!function(e){const n=new Float64Array(e);let a=0;w.indexBytesPerElement=n[a++],w.min=n[a++],w.max=n[a++],t.Cartesian3.unpack(n,a,C),a+=t.Cartesian3.packedLength,t.Ellipsoid.unpack(n,a,I),a+=t.Ellipsoid.packedLength,s.Rectangle.unpack(n,a,x)}(c.packedBuffer),d=2===w.indexBytesPerElement?new Uint16Array(c.indices):new Uint32Array(c.indices);const l=new Uint16Array(c.positions),u=new Uint32Array(c.counts),h=new Uint32Array(c.indexCounts),g=new Uint32Array(c.batchIds),p=new Uint32Array(c.batchTableColors),b=new Array(u.length),m=C,y=I;let O=x;const U=w.min,P=w.max;let F,M,S,D=c.minimumHeights,R=c.maximumHeights;a.defined(D)&&a.defined(R)&&(D=new Float32Array(D),R=new Float32Array(R));const _=l.length/2,G=l.subarray(0,_),V=l.subarray(_,2*_);e.AttributeCompression.zigZagDeltaDecode(G,V);const Y=new Float64Array(3*_);for(F=0;F<_;++F){const e=G[F],n=V[F],a=o.CesiumMath.lerp(O.west,O.east,e/32767),r=o.CesiumMath.lerp(O.south,O.north,n/32767),i=t.Cartographic.fromRadians(a,r,0,B),s=y.cartographicToCartesian(i,A);t.Cartesian3.pack(s,Y,3*F)}const v=u.length,H=new Array(v),W=new Array(v);let z=0,Z=0;for(F=0;F<v;++F)H[F]=z,W[F]=Z,z+=u[F],Z+=h[F];const j=new Float32Array(3*_*2),q=new Uint16Array(2*_),J=new Uint32Array(W.length),K=new Uint32Array(h.length);let Q=[];const X={};for(F=0;F<v;++F)S=p[F],a.defined(X[S])?(X[S].positionLength+=u[F],X[S].indexLength+=h[F],X[S].batchIds.push(F)):X[S]={positionLength:u[F],indexLength:h[F],offset:0,indexOffset:0,batchIds:[F]};let $,ee=0,te=0;for(S in X)if(X.hasOwnProperty(S)){$=X[S],$.offset=ee,$.indexOffset=te;const e=2*$.positionLength,t=2*$.indexLength+6*$.positionLength;ee+=e,te+=t,$.indexLength=t}const ne=[];for(S in X)X.hasOwnProperty(S)&&($=X[S],ne.push({color:n.Color.fromRgba(parseInt(S)),offset:$.indexOffset,count:$.indexLength,batchIds:$.batchIds}));for(F=0;F<v;++F){S=p[F],$=X[S];const e=$.offset;let n=3*e,r=e;const o=H[F],s=u[F],c=g[F];let f=U,l=P;a.defined(D)&&a.defined(R)&&(f=D[F],l=R[F]);let C=Number.POSITIVE_INFINITY,I=Number.NEGATIVE_INFINITY,x=Number.POSITIVE_INFINITY,w=Number.NEGATIVE_INFINITY;for(M=0;M<s;++M){const e=t.Cartesian3.unpack(Y,3*o+3*M,A);y.scaleToGeodeticSurface(e,e);const a=y.cartesianToCartographic(e,B),i=a.latitude,s=a.longitude;C=Math.min(i,C),I=Math.max(i,I),x=Math.min(s,x),w=Math.max(s,w);const d=y.geodeticSurfaceNormal(e,E);let u=t.Cartesian3.multiplyByScalar(d,f,N);const h=t.Cartesian3.add(e,u,T);u=t.Cartesian3.multiplyByScalar(d,l,u);const g=t.Cartesian3.add(e,u,k);t.Cartesian3.subtract(g,m,g),t.Cartesian3.subtract(h,m,h),t.Cartesian3.pack(g,j,n),t.Cartesian3.pack(h,j,n+3),q[r]=c,q[r+1]=c,n+=6,r+=2}O=L,O.west=x,O.east=w,O.south=C,O.north=I,b[F]=i.OrientedBoundingBox.fromRectangle(O,U,P,y);let _=$.indexOffset;const G=W[F],V=h[F];for(J[F]=_,M=0;M<V;M+=3){const t=d[G+M]-o,n=d[G+M+1]-o,a=d[G+M+2]-o;Q[_++]=2*t+e,Q[_++]=2*n+e,Q[_++]=2*a+e,Q[_++]=2*a+1+e,Q[_++]=2*n+1+e,Q[_++]=2*t+1+e}for(M=0;M<s;++M){const t=M,n=(M+1)%s;Q[_++]=2*t+1+e,Q[_++]=2*n+e,Q[_++]=2*t+e,Q[_++]=2*t+1+e,Q[_++]=2*n+1+e,Q[_++]=2*n+e}$.offset+=2*s,$.indexOffset=_,K[F]=_-J[F]}Q=r.IndexDatatype.createTypedArray(j.length/3,Q);const ae=ne.length;for(let e=0;e<ae;++e){const t=ne[e].batchIds;let n=0;const a=t.length;for(let e=0;e<a;++e)n+=K[t[e]];ne[e].count=n}const re=function(e,t,a){const r=t.length,o=2+r*i.OrientedBoundingBox.packedLength+1+function(e){const t=e.length;let a=0;for(let r=0;r<t;++r)a+=n.Color.packedLength+3+e[r].batchIds.length;return a}(a),s=new Float64Array(o);let c=0;s[c++]=e,s[c++]=r;for(let e=0;e<r;++e)i.OrientedBoundingBox.pack(t[e],s,c),c+=i.OrientedBoundingBox.packedLength;const f=a.length;s[c++]=f;for(let e=0;e<f;++e){const t=a[e];n.Color.pack(t.color,s,c),c+=n.Color.packedLength,s[c++]=t.offset,s[c++]=t.count;const r=t.batchIds,o=r.length;s[c++]=o;for(let e=0;e<o;++e)s[c++]=r[e]}return s}(2===Q.BYTES_PER_ELEMENT?r.IndexDatatype.UNSIGNED_SHORT:r.IndexDatatype.UNSIGNED_INT,b,ne);return f.push(j.buffer,Q.buffer,J.buffer,K.buffer,q.buffer,re.buffer),{positions:j.buffer,indices:Q.buffer,indexOffsets:J.buffer,indexCounts:K.buffer,batchIds:q.buffer,packedBuffer:re.buffer}}))}));