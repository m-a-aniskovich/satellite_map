define(["./arrayRemoveDuplicates-d2061e85","./BoundingRectangle-5fd6403a","./Transforms-e2d4a55a","./Matrix2-e1298525","./Matrix3-41c58dde","./Check-6ede7e26","./ComponentDatatype-cf1fa08e","./CoplanarPolygonGeometryLibrary-59c69b0a","./defaultValue-fe22d8c0","./GeometryAttribute-13da9466","./GeometryAttributes-ad136444","./GeometryInstance-34d9e21e","./GeometryPipeline-03bc5709","./IndexDatatype-2643aa47","./Math-0a2ac845","./PolygonGeometryLibrary-d447448d","./PolygonPipeline-460cce4e","./VertexFormat-030f11ff","./combine-d9581036","./RuntimeError-ef395448","./WebGLConstants-0b1ce7ba","./OrientedBoundingBox-29fb0fcd","./EllipsoidTangentPlane-546c0d5e","./AxisAlignedBoundingBox-4bfd84f3","./IntersectionTests-85350792","./Plane-4c3d403b","./AttributeCompression-f9f6c717","./EncodedCartesian3-57415c8a","./ArcType-2d9abbbc","./EllipsoidRhumbLine-ef872433"],(function(e,t,n,o,a,r,i,s,l,c,y,p,d,u,m,g,f,h,C,b,x,P,A,L,w,G,F,v,k,E){"use strict";const _=new a.Cartesian3,T=new t.BoundingRectangle,D=new o.Cartesian2,V=new o.Cartesian2,R=new a.Cartesian3,H=new a.Cartesian3,I=new a.Cartesian3,M=new a.Cartesian3,B=new a.Cartesian3,O=new a.Cartesian3,z=new n.Quaternion,S=new a.Matrix3,N=new a.Matrix3,Q=new a.Cartesian3;function j(e,t,r,s,p,d,g,h,C){const b=e.positions;let x=f.PolygonPipeline.triangulate(e.positions2D,e.holes);x.length<3&&(x=[0,1,2]);const P=u.IndexDatatype.createTypedArray(b.length,x.length);P.set(x);let A=S;if(0!==s){let e=n.Quaternion.fromAxisAngle(g,s,z);if(A=a.Matrix3.fromQuaternion(e,A),t.tangent||t.bitangent){e=n.Quaternion.fromAxisAngle(g,-s,z);const o=a.Matrix3.fromQuaternion(e,N);h=a.Cartesian3.normalize(a.Matrix3.multiplyByVector(o,h,h),h),t.bitangent&&(C=a.Cartesian3.normalize(a.Cartesian3.cross(g,h,C),C))}}else A=a.Matrix3.clone(a.Matrix3.IDENTITY,A);const L=V;t.st&&(L.x=r.x,L.y=r.y);const w=b.length,G=3*w,F=new Float64Array(G),v=t.normal?new Float32Array(G):void 0,k=t.tangent?new Float32Array(G):void 0,E=t.bitangent?new Float32Array(G):void 0,T=t.st?new Float32Array(2*w):void 0;let R=0,H=0,I=0,M=0,B=0;for(let e=0;e<w;e++){const n=b[e];if(F[R++]=n.x,F[R++]=n.y,F[R++]=n.z,t.st)if(l.defined(p)&&p.positions.length===w)T[B++]=p.positions[e].x,T[B++]=p.positions[e].y;else{const e=d(a.Matrix3.multiplyByVector(A,n,_),D);o.Cartesian2.subtract(e,L,e);const t=m.CesiumMath.clamp(e.x/r.width,0,1),i=m.CesiumMath.clamp(e.y/r.height,0,1);T[B++]=t,T[B++]=i}t.normal&&(v[H++]=g.x,v[H++]=g.y,v[H++]=g.z),t.tangent&&(k[M++]=h.x,k[M++]=h.y,k[M++]=h.z),t.bitangent&&(E[I++]=C.x,E[I++]=C.y,E[I++]=C.z)}const O=new y.GeometryAttributes;return t.position&&(O.position=new c.GeometryAttribute({componentDatatype:i.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:F})),t.normal&&(O.normal=new c.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:v})),t.tangent&&(O.tangent=new c.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:k})),t.bitangent&&(O.bitangent=new c.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:E})),t.st&&(O.st=new c.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:T})),new c.Geometry({attributes:O,indices:P,primitiveType:c.PrimitiveType.TRIANGLES})}function U(e){const t=(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).polygonHierarchy,n=e.textureCoordinates;r.Check.defined("options.polygonHierarchy",t);const i=l.defaultValue(e.vertexFormat,h.VertexFormat.DEFAULT);this._vertexFormat=h.VertexFormat.clone(i),this._polygonHierarchy=t,this._stRotation=l.defaultValue(e.stRotation,0),this._ellipsoid=a.Ellipsoid.clone(l.defaultValue(e.ellipsoid,a.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this._textureCoordinates=n,this.packedLength=g.PolygonGeometryLibrary.computeHierarchyPackedLength(t,a.Cartesian3)+h.VertexFormat.packedLength+a.Ellipsoid.packedLength+(l.defined(n)?g.PolygonGeometryLibrary.computeHierarchyPackedLength(n,o.Cartesian2):1)+2}U.fromPositions=function(e){return e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT),r.Check.defined("options.positions",e.positions),new U({polygonHierarchy:{positions:e.positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid,textureCoordinates:e.textureCoordinates})},U.pack=function(e,t,n){return r.Check.typeOf.object("value",e),r.Check.defined("array",t),n=l.defaultValue(n,0),n=g.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,n,a.Cartesian3),a.Ellipsoid.pack(e._ellipsoid,t,n),n+=a.Ellipsoid.packedLength,h.VertexFormat.pack(e._vertexFormat,t,n),n+=h.VertexFormat.packedLength,t[n++]=e._stRotation,l.defined(e._textureCoordinates)?n=g.PolygonGeometryLibrary.packPolygonHierarchy(e._textureCoordinates,t,n,o.Cartesian2):t[n++]=-1,t[n++]=e.packedLength,t};const Y=a.Ellipsoid.clone(a.Ellipsoid.UNIT_SPHERE),q=new h.VertexFormat,J={polygonHierarchy:{}};return U.unpack=function(e,t,n){r.Check.defined("array",e),t=l.defaultValue(t,0);const i=g.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t,a.Cartesian3);t=i.startingIndex,delete i.startingIndex;const s=a.Ellipsoid.unpack(e,t,Y);t+=a.Ellipsoid.packedLength;const c=h.VertexFormat.unpack(e,t,q);t+=h.VertexFormat.packedLength;const y=e[t++],p=-1===e[t]?void 0:g.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t,o.Cartesian2);l.defined(p)?(t=p.startingIndex,delete p.startingIndex):t++;const d=e[t++];return l.defined(n)||(n=new U(J)),n._polygonHierarchy=i,n._ellipsoid=a.Ellipsoid.clone(s,n._ellipsoid),n._vertexFormat=h.VertexFormat.clone(c,n._vertexFormat),n._stRotation=y,n._textureCoordinates=p,n.packedLength=d,n},U.createGeometry=function(t){const o=t._vertexFormat,r=t._polygonHierarchy,i=t._stRotation,y=t._textureCoordinates,f=l.defined(y);let h=r.positions;if(h=e.arrayRemoveDuplicates(h,a.Cartesian3.equalsEpsilon,!0),h.length<3)return;let C=R,b=H,x=I,P=B;const A=O;if(!s.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(h,M,P,A))return;if(C=a.Cartesian3.cross(P,A,C),C=a.Cartesian3.normalize(C,C),!a.Cartesian3.equalsEpsilon(M,a.Cartesian3.ZERO,m.CesiumMath.EPSILON6)){const e=t._ellipsoid.geodeticSurfaceNormal(M,Q);a.Cartesian3.dot(C,e)<0&&(C=a.Cartesian3.negate(C,C),P=a.Cartesian3.negate(P,P))}const L=s.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(M,P,A),w=s.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(M,P,A);o.tangent&&(b=a.Cartesian3.clone(P,b)),o.bitangent&&(x=a.Cartesian3.clone(A,x));const G=g.PolygonGeometryLibrary.polygonsFromHierarchy(r,f,L,!1),F=G.hierarchy,v=G.polygons,k=f?g.PolygonGeometryLibrary.polygonsFromHierarchy(y,!0,(function(e){return e}),!1).polygons:void 0;if(0===F.length)return;h=F[0].outerRing;const E=n.BoundingSphere.fromPoints(h),_=g.PolygonGeometryLibrary.computeBoundingRectangle(C,w,h,i,T),D=[];for(let e=0;e<v.length;e++){const t=new p.GeometryInstance({geometry:j(v[e],o,_,i,f?k[e]:void 0,w,C,b,x)});D.push(t)}const V=d.GeometryPipeline.combineInstances(D)[0];V.attributes.position.values=new Float64Array(V.attributes.position.values),V.indices=u.IndexDatatype.createTypedArray(V.attributes.position.values.length/3,V.indices);const z=V.attributes;return o.position||delete z.position,new c.Geometry({attributes:z,indices:V.indices,primitiveType:V.primitiveType,boundingSphere:E})},function(e,t){return l.defined(t)&&(e=U.unpack(e,t)),U.createGeometry(e)}}));